#!/usr/bin/env bash

set -e

[ "$BUILDPACK_XTRACE" ] && set -o xtrace

BIN_DIR=$(cd $(dirname $0); pwd)
BUILD_DIR=$1

for ENV_DIR in $BUILD_DIR/{catfish,etc/environments}/{heroku,production}; do
    if test -f $ENV_DIR/env -a -f $ENV_DIR/procfile; then
        echo "Found config files in $ENV_DIR"
        cp $ENV_DIR/env $BUILD_DIR/.env
        cp $ENV_DIR/procfile $BUILD_DIR/Procfile
        sed 's/^/export /' $ENV_DIR/env > "$BIN_DIR/../export"
        exit 0
    fi
done
echo "No acceptable environment found"
exit 1
